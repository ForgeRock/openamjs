
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">




<html>
<head>
    <title>OpenAM Script example page</title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="-1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="css/demostyles.css" type="text/css">
<script type="text/javascript" src="jquery-1.11.2.js"></script>
<script type="text/javascript" src="openam.js"></script>
</head>

<body class="NAPAStyle">

<script>

$(document).ready(function() {
    var thisURL = getMyURL();
    var fbmodule = "facebook";
    var gmodule = "google";
    var msnmodule = "msn";
    var amodule = "amazon";
    var limodule = "linkedin";
    
    var openam = new openamConfig(
        "http://openam1.example.com:8080/openam", // openam base url
        "/",                             // default realm
        "iPlanetDirectoryPro",                 // Session cookie name
        ".example.com",                       // Domain name 
        false,                                 // Is legacy enabled?
        true);                                 // Is debug enabled (see java console)? 

    if (openam.isUserAuthenticated()) {
            $('#loginBox').hide();
            $('#welcomeAndLogout').show();
            // get the attributes you want to use
            attributes_ = openam.getIdentityAttributes("mail,givenName,sn,cn,phoneNumber");
            // display the attributes
            $('#attributeWdw').html(printAllStuff(attributes_)).slideDown;
            $('#welcome1').html("Welcome <b>" + uid + "</b>");      

    } else {  
            $('#loginBox').show();
            $('#welcomeAndLogout').hide();
            $('#login1').hide();
            $('#cross').hide();
            $('#flip').show();     
            $('#attributeWdw').html("<p>You are not authenticated</p>").slideDown();
    }
    
    $('#errormessage').hide();
    $("#flip").click(function(){
	$("#flip").hide();
	$("#login1").slideDown("fast");
	$("#cross").show(); 
    });
    
    $("#cross").click(function(){
	$("#flip").show();
	$("#login1").slideUp("fast");
	$("#cross").hide(); 
    });
        
    $("#logoutBtn").click(function(){
        openam.logout();
    });
    
    $("#facebook").click(function(){
	openam.redirectAuthNWithModule(fbmodule);
    });
    
    $("#linkedin").click(function(){
	openam.redirectAuthNWithModule(limodule);
    });
    
    $("#amazon").click(function(){
	openam.redirectAuthNWithModule(amodule);
    });
    
    $("#google").click(function(){
	openam.redirectAuthNWithModule(gmodule);
    });
    
    $("#msn").click(function(){
	openam.redirectAuthNWithModule(msnmodule);
    });
       
    $("input").focus(function() {
       $('#errorMessage').html('').slideDown(); 
    });
    
    $('form[name=loginForm]').submit(function() {
        var tokenId_ = openam.authenticate($('[name=username]').val(), 
                                           $('[name=password]').val());
        if (tokenId_) {
            window.location = thisURL;  
        } else {
            $('#errorMessage').html('The authentication failed').slideDown();  
        }
	return false;              
    });
});

function printAllStuff(data) {
        var outputV = "";
        var attributes = JSON.parse(data)
        for (var key in attributes) {
            if (attributes.hasOwnProperty(key)) {
                outputV = "<tr>" +
                    "<td class=\"left\">" + key + ":</td>" +
                    "<td class=\"right\">" + attributes[key]+ "</td>" +
                    "</tr>" +
                    outputV;
            }
        }
        outputV = "<br><table class=\"Info\"> " + outputV + "</table>";
        return outputV;

}
</script>

    <div id="header">
        <img class="image-float-left" alt="OpenAM" src="images/ForgeRock_Logo.png"> 

        <div id="loginBox">
            <img id="flip" class="loginButton image-float-right" 
                 src="images/arrowdown2.png" alt="Login" style="display: block;">
            <div id="login1" style="display: none;">
                <img id="cross" class="loginButton image-float-right" 
                     src="images/cross.gif" style="display: none;">
                <table>
                    <tr>
                        <td width="5%">&nbsp;</td>
                        <td width="45%" align="center" valign="middle">          
                            <form method="post" action="" name="loginForm">
                                <table>
                                    <tr><td>Login with your existing account:</td></tr>
                                    <tr><td height="10"></td></tr>
                                    <tr><td>Email</td></tr>
                                    <tr><td><input type="text" name="username" size="20" /></td></tr>
                                    <tr><td>Password</td></tr>
                                    <tr><td><input type="password" name="password" size="20" /></td></tr>
                                    <tr><td><input type="submit" value="Login" /></td></tr>
                                    <tr><td>&nbsp;</td></tr>
                                    <tr><td><div id="errorMessage"></div></td></tr>
                                </table> 
                            </form>
                        </td>
                        <td width="5%" valign="middle">
                            <table>
                                <tr><td align="center" valign="middle"><img src="images/linea.png" height="100" /></td></tr>
                                <tr><td align="center" valign="middle">OR</td></tr>
                                <tr><td align="center" valign="middle"><img src="images/linea.png" height="100" /></td></tr>
                            </table>
                        </td>
                        <td align="center" valign="middle" width="45%">
                            <table>
                                <tr><td align="center" valign="middle">Use your social media account:
                                    </td>
                                </tr>
                                <tr><td></td></tr>
                                <tr><td align="center" valign="middle">
                                        <img id="facebook" class="socialButton" 
                                             src="images/facebook.png" alt="facebook">
                                    </td>
                                </tr>
                                <tr><td align="center" valign="middle">
                                        <img id="linkedin" class="socialButton" 
                                             src="images/linkedin.png" alt="linkedin">
                                    </td>
                                </tr>
                                <tr><td align="center" valign="middle">
                                        <img id="google" class="socialButton" 
                                             src="images/google.png" alt="google">
                                    </td>
                                </tr>
                                <tr><td align="center" valign="middle">
                                        <img id="msn" class="socialButton" 
                                             src="images/msn.png" alt="msn">
                                    </td>
                                </tr>
                                <tr><td align="center" valign="middle">
                                        <img id="amazon" class="socialButton" 
                                             src="images/amazon.png" alt="amazon">
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="welcomeAndLogout">
            <div id="welcome1" class="image-float-left"></div>
            <div>
                <img id="logoutBtn" class="image-float-right" src="images/logout.png" alt="Logout">
            </div>
        </div>     

    </div>
    <!-- The header ends here -->
    <div id="franja">
        <!- The thin fringe/bar between header and wdw container -->
    </div>

    <div id="wdw-container">
        <div id="wdw1">
            <div id="franjita">
                <span class="BoldLetters">Some Session Attributes</span>
            </div>
            <div id="attributeWdw"></div>
        </div>        
    </div>
</body>
</html>
